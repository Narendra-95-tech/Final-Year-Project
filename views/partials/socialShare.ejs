<% const isActive=typeof isWishlisted !=='undefined' && isWishlisted; %>
    <div class="header-actions">
        <button class="action-btn share-btn" onclick="openShareModal()">
            <i class="fas fa-share-square"></i>
            <span>Share</span>
        </button>
        <button class="action-btn save-btn <%= isActive ? 'active' : '' %>"
            onclick="toggleWishlist(this, '<%= itemId %>')">
            <i class="<%= isActive ? 'fas' : 'far' %> fa-heart" <%=isActive ? 'style="color: #ff385c;"' : '' %>></i>
            <span>
                <%= isActive ? 'Saved' : 'Save' %>
            </span>
        </button>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="share-modal" onclick="closeShareModal(event)">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3>
                    <%= typeof shareTitle !=='undefined' ? shareTitle : 'Share this' %>
                </h3>
                <button class="close-share-modal" onclick="closeShareModal()">&times;</button>
            </div>
            <div class="share-options">
                <!-- WhatsApp -->
                <a href="https://api.whatsapp.com/send?text=<%= encodeURIComponent(shareText + ' ' + currentUrl) %>"
                    target="_blank" class="share-option whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </a>
                <!-- Facebook -->
                <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent(currentUrl) %>"
                    target="_blank" class="share-option facebook">
                    <i class="fab fa-facebook-f"></i>
                    <span>Facebook</span>
                </a>
                <!-- Twitter -->
                <a href="https://twitter.com/intent/tweet?text=<%= encodeURIComponent(shareText) %>&url=<%= encodeURIComponent(currentUrl) %>"
                    target="_blank" class="share-option twitter">
                    <i class="fab fa-twitter"></i>
                    <span>Twitter</span>
                </a>
                <!-- LinkedIn -->
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=<%= encodeURIComponent(currentUrl) %>"
                    target="_blank" class="share-option linkedin">
                    <i class="fab fa-linkedin-in"></i>
                    <span>LinkedIn</span>
                </a>
                <!-- Copy Link -->
                <div class="share-option copy-link" onclick="copyShareLink()">
                    <i class="far fa-copy"></i>
                    <span>Copy Link</span>
                </div>
                <!-- Email -->
                <a href="mailto:?subject=<%= encodeURIComponent(shareSubject) %>&body=<%= encodeURIComponent(shareText + ' ' + currentUrl) %>"
                    class="share-option email">
                    <i class="fas fa-envelope"></i>
                    <span>Email</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        function openShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'flex';
            // Force reflow
            modal.offsetHeight;
            modal.classList.add('open');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeShareModal(event) {
            if (event && event.target !== event.currentTarget && event.target.className !== 'close-share-modal') return;

            const modal = document.getElementById('shareModal');
            modal.classList.remove('open');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            document.body.style.overflow = '';
        }

        function copyShareLink() {
            navigator.clipboard.writeText('<%= currentUrl %>').then(() => {
                if (window.wishlistHandler && window.wishlistHandler.showNotification) {
                    window.wishlistHandler.showNotification('Link copied to clipboard!');
                } else {
                    alert('Link copied to clipboard!');
                }
                closeShareModal();
            }).catch(err => {
                console.error('Failed to copy', err);
                alert('Failed to copy link');
            });
        }
    </script>