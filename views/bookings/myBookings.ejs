<% layout("/layouts/boilerplate") -%>
<body>
  <div class="row justify-content-center mt-3">
    <div class="col-md-8">
      <h3>My Bookings</h3>

      <% if(bookings.length === 0) { %>
        <p>No bookings yet.</p>
      <% } else { %>
        <% bookings.forEach(booking => { %>
          <div class="card mb-3">
            <div class="card-body d-flex justify-content-between align-items-center flex-wrap" style="position: relative;">
              <div>
                <h5><%= booking.listing ? booking.listing.title : booking.dhaba ? booking.dhaba.title : booking.vehicle.title %></h5>
                <% if (booking.type === 'listing') { %>
                  <p>Check-in: <%= booking.startDate.toDateString() %></p>
                  <p>Check-out: <%= booking.endDate.toDateString() %></p>
                <% } else if (booking.type === 'dhaba') { %>
                  <p>Reservation: <%= booking.startDate.toDateString() %></p>
                  <p>Time: <%= booking.time %></p>
                <% } else if (booking.type === 'vehicle') { %>
                  <p>Rental Start: <%= booking.startDate.toDateString() %> <%= booking.startTime %></p>
                  <p>Rental End: <%= booking.endDate.toDateString() %> <%= booking.endTime %></p>
                  <p>Pickup: <%= booking.pickupLocation || 'N/A' %></p>
                <% } %>
                <p>Total: â‚¹<%= booking.totalPrice %></p>
                <p>Status: 
                  <% if(booking.isPaid) { %>
                    <span class="text-success">Paid</span>
                  <% } else { %>
                    <span class="text-danger">Pending Payment</span>
                  <% } %>
                </p>
              </div>

              <div class="d-flex flex-column gap-2">
                <% if(!booking.isPaid) { %>
                  <form method="POST" action="/bookings/<%= booking._id %>/pay">
                    <button class="btn btn-success btn-sm">Pay Now</button>
                  </form>
                <% } %>
                <% if(new Date(booking.startDate) > new Date()) { %>
                  <form method="POST" action="/bookings/<%= booking._id %>/cancel">
                    <button class="btn btn-danger btn-sm">Cancel Booking</button>
                  </form>
                <% } %>
              </div>

              <!-- Chat bubble -->
              <div class="booking-chat" id="chat-<%= booking._id %>">
                  <div class="chat-header">Chat</div>
                  <div class="chat-body">
                      <div class="messages"></div>
                      <div class="chat-input-area">
                          <input type="text" class="chat-input" placeholder="Type a message..." />
                          <button class="send-btn">Send</button>
                      </div>
                  </div>
              </div>

            </div> <!-- card-body -->
          </div> <!-- card -->
        <% }); %>
      <% } %>
    </div>
  </div>

  <!-- Include chatbot JS -->
  <script src="/chatbot.js"></script>
</body>
