<% layout("/layouts/boilerplate") -%>

<style>
  .payment-hero {
    background: linear-gradient(135deg, var(--primary-orange), var(--primary-orange-hover));
    color: var(--white);
    padding: 3rem 0;
    margin-bottom: 2rem;
  }

  .payment-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .payment-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
  }

  .payment-card {
    background: var(--white);
    border-radius: var(--radius-2xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
  }

  .payment-summary {
    background: var(--gray-50);
    padding: 2rem;
    border-bottom: 1px solid var(--gray-200);
  }

  .payment-amount {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-orange);
  }

  .booking-details {
    padding: 2rem;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-200);
  }

  .detail-row:last-child {
    border-bottom: none;
  }

  .detail-label {
    font-weight: 600;
    color: var(--gray-700);
  }

  .detail-value {
    color: var(--gray-900);
    font-weight: 500;
  }
</style>

<section class="payment-hero">
  <div class="container text-center">
    <h1 class="payment-title">Complete Your Payment</h1>
    <p class="payment-subtitle">Secure payment processing for your booking</p>
  </div>
</section>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="payment-card animate-fade-in">
        <div class="payment-summary text-center">
          <h3 class="mb-3">Booking Summary</h3>
          <% if (booking.type === 'listing' && booking.listing) { %>
            <div class="mb-4">
              <img src="<%= booking.listing.image?.url || 'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=200&h=150&fit=crop&crop=center' %>"
                   class="img-fluid rounded mb-3" alt="<%= booking.listing.title %>" style="max-height: 150px; object-fit: cover;">
              <h4><%= booking.listing.title %></h4>
              <p class="text-muted">
                <i class="fas fa-map-marker-alt me-1"></i>
                <%= booking.listing.location %>, <%= booking.listing.country %>
              </p>
            </div>
          <% } else if (booking.type === 'dhaba' && booking.dhaba) { %>
            <div class="mb-4">
              <img src="<%= booking.dhaba.image?.url || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=200&h=150&fit=crop&crop=center' %>"
                   class="img-fluid rounded mb-3" alt="<%= booking.dhaba.title %>" style="max-height: 150px; object-fit: cover;">
              <h4><%= booking.dhaba.title %></h4>
              <p class="text-muted">
                <i class="fas fa-map-marker-alt me-1"></i>
                <%= booking.dhaba.location %>, <%= booking.dhaba.country %>
              </p>
            </div>
          <% } %>

          <div class="payment-amount">
            ‚Çπ<%= booking.totalPrice.toLocaleString("en-IN") %>
          </div>
          <p class="text-muted">Total Amount Due</p>
        </div>

        <div class="booking-details">
          <h4 class="mb-4">Booking Details</h4>

          <div class="detail-row">
            <span class="detail-label">Booking Type</span>
            <span class="detail-value">
              <% if (booking.type === 'listing') { %>
                <span class="badge bg-primary">üè† Stay</span>
              <% } else { %>
                <span class="badge bg-warning">üçΩÔ∏è Dining</span>
              <% } %>
            </span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Check-in Date</span>
            <span class="detail-value"><%= booking.startDate.toLocaleDateString() %></span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Check-out Date</span>
            <span class="detail-value"><%= booking.endDate.toLocaleDateString() %></span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Number of Guests</span>
            <span class="detail-value"><%= booking.guests %></span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Total Price</span>
            <span class="detail-value">‚Çπ<%= booking.totalPrice.toLocaleString("en-IN") %></span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Payment Status</span>
            <span class="detail-value">
              <% if (booking.isPaid) { %>
                <span class="badge bg-success">‚úì Paid</span>
              <% } else { %>
                <span class="badge bg-warning">‚è≥ Pending</span>
              <% } %>
            </span>
          </div>
        </div>

        <div class="card-body border-top">
          <% if (!booking.isPaid) { %>
            <div class="text-center">
              <h5 class="mb-3">Payment Options</h5>
              <p class="text-muted mb-4">Choose your preferred payment method to complete the booking</p>

              <div class="row g-3">
                <div class="col-md-6">
                  <button class="btn btn-primary w-100 py-3" onclick="processPayment()">
                    <i class="fas fa-credit-card me-2"></i>
                    Pay with Card
                  </button>
                </div>
                <div class="col-md-6">
                  <button class="btn btn-outline-primary w-100 py-3" onclick="payWithUPI()">
                    <i class="fas fa-mobile-alt me-2"></i>
                    Pay with UPI
                  </button>
                </div>
              </div>

              <div class="mt-4 p-3 bg-light rounded">
                <h6 class="mb-2">üí≥ Secure Payment</h6>
                <p class="small text-muted mb-0">
                  Your payment information is encrypted and secure. We accept all major credit cards and UPI payments.
                </p>
              </div>
            </div>
          <% } else { %>
            <div class="text-center py-4">
              <div class="mb-3">
                <i class="fas fa-check-circle fa-4x text-success"></i>
              </div>
              <h4 class="text-success mb-3">Payment Successful!</h4>
              <p class="text-muted mb-4">Your booking has been confirmed and payment has been processed successfully.</p>
              <a href="/bookings" class="btn btn-primary">
                <i class="fas fa-arrow-left me-2"></i>Back to My Bookings
              </a>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  async function processPayment() {
    try {
      // Here you would integrate with Stripe or other payment gateway
      alert('Payment processing would be implemented here with Stripe integration');
      // For now, just mark as paid and redirect
      const response = await fetch(`/bookings/<%= booking._id %>/success`, {
        method: 'GET',
        credentials: 'same-origin'
      });
      if (response.ok) {
        window.location.reload();
      }
    } catch (error) {
      console.error('Payment error:', error);
      alert('Payment processing failed. Please try again.');
    }
  }

  function payWithUPI() {
    alert('UPI payment would be implemented here');
    // Implementation would depend on the UPI provider chosen
  }
</script>
