<% layout("/layouts/boilerplate") -%>

<style>
  .search-results {
    padding: 2rem 0;
  }

  .section-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: none;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 2rem;
  }

  .section-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  }

  .section-header {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
    padding: 1.5rem;
    text-align: center;
  }

  .section-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .item-card {
    border: none;
    border-radius: 10px;
    overflow: hidden;
    transition: transform 0.2s ease;
    margin-bottom: 1rem;
  }

  .item-card:hover {
    transform: translateY(-3px);
  }

  .item-image {
    height: 200px;
    object-fit: cover;
  }

  .price-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255, 107, 107, 0.9);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.9rem;
  }

  .no-results {
    text-align: center;
    padding: 3rem 0;
    color: #666;
  }

  .no-results i {
    font-size: 4rem;
    color: #ddd;
    margin-bottom: 1rem;
  }
</style>

<div class="search-results">
  <div class="container">
    <!-- Search Header -->
    <div class="text-center mb-5">
      <h2>Search Results</h2>
      <p class="text-muted">
        <% if (query) { %>
          Showing results for "<strong><%= query %></strong>"
        <% } %>
        <% if (totalResults > 0) { %>
          - Found <strong><%= totalResults %></strong> results
        <% } %>
      </p>
    </div>

    <!-- Listings Results -->
    <% if (listings && listings.length > 0) { %>
      <div class="section-card card">
        <div class="section-header">
          <i class="fa fa-home section-icon"></i>
          <h3>Vacation Rentals (<%= listings.length %>)</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <% for (let listing of listings) { %>
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card item-card position-relative">
                  <img src="<%= listing.image?.url || 'https://via.placeholder.com/300x200?text=No+Image' %>"
                       class="card-img-top item-image" alt="<%= listing.title %>">
                  <span class="price-badge">₹<%= listing.price ? Number(listing.price).toLocaleString("en-IN") : "N/A" %> / night</span>
                  <div class="card-body">
                    <h6 class="card-title"><%= listing.title %></h6>
                    <p class="card-text small text-muted">
                      <i class="fa fa-map-marker-alt me-1"></i><%= listing.location %>
                    </p>
                    <a href="/listings/<%= listing._id %>" class="btn btn-sm btn-outline-primary">View Details</a>
                  </div>
                </div>
              </div>
            <% } %>
          </div>
          <div class="text-center mt-3">
            <a href="/listings?q=<%= query %>" class="btn btn-outline-primary">View All Listings →</a>
          </div>
        </div>
      </div>
    <% } %>

    <!-- Vehicles Results -->
    <% if (vehicles && vehicles.length > 0) { %>
      <div class="section-card card">
        <div class="section-header" style="background: linear-gradient(135deg, #28a745, #20c997);">
          <i class="fa fa-car section-icon"></i>
          <h3>Vehicle Rentals (<%= vehicles.length %>)</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <% for (let vehicle of vehicles) { %>
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card item-card position-relative">
                  <img src="<%= vehicle.image?.url || 'https://via.placeholder.com/300x200?text=No+Image' %>"
                       class="card-img-top item-image" alt="<%= vehicle.title %>">
                  <span class="price-badge">₹<%= vehicle.price ? Number(vehicle.price).toLocaleString("en-IN") : "N/A" %> / day</span>
                  <div class="card-body">
                    <h6 class="card-title"><%= vehicle.title %></h6>
                    <p class="card-text small text-muted">
                      <span class="badge badge-secondary me-1"><%= vehicle.vehicleType %></span>
                      <i class="fa fa-map-marker-alt me-1"></i><%= vehicle.location %>
                    </p>
                    <a href="/vehicles/<%= vehicle._id %>" class="btn btn-sm btn-outline-success">View Details</a>
                  </div>
                </div>
              </div>
            <% } %>
          </div>
          <div class="text-center mt-3">
            <a href="/vehicles?q=<%= query %>" class="btn btn-outline-success">View All Vehicles →</a>
          </div>
        </div>
      </div>
    <% } %>

    <!-- Dhabas Results -->
    <% if (dhabas && dhabas.length > 0) { %>
      <div class="section-card card">
        <div class="section-header" style="background: linear-gradient(135deg, #fd7e14, #e83e8c);">
          <i class="fa fa-utensils section-icon"></i>
          <h3>Local Dhabas (<%= dhabas.length %>)</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <% for (let dhaba of dhabas) { %>
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card item-card position-relative">
                  <img src="<%= dhaba.image?.url || 'https://via.placeholder.com/300x200?text=No+Image' %>"
                       class="card-img-top item-image" alt="<%= dhaba.title %>">
                  <span class="price-badge"><%= dhaba.category %> • <%= dhaba.cuisine %></span>
                  <div class="card-body">
                    <h6 class="card-title"><%= dhaba.title %></h6>
                    <div class="mb-2">
                      <% for (let i = 1; i <= 5; i++) { %>
                        <i class="fa fa-star <%= i <= dhaba.rating ? 'text-warning' : 'text-muted' %>"></i>
                      <% } %>
                      <span class="ms-2 text-muted">(<%= dhaba.rating %>)</span>
                    </div>
                    <p class="card-text small text-muted">
                      <i class="fa fa-map-marker-alt me-1"></i><%= dhaba.location %>
                    </p>
                    <a href="/dhabas/<%= dhaba._id %>" class="btn btn-sm btn-outline-warning">View Details</a>
                  </div>
                </div>
              </div>
            <% } %>
          </div>
          <div class="text-center mt-3">
            <a href="/dhabas?q=<%= query %><%= (typeof minRating !== 'undefined' && minRating) ? '&minRating=' + minRating : '' %>" class="btn btn-outline-warning">View All Dhabas →</a>
          </div>
        </div>
      </div>
    <% } %>

    <!-- No Results -->
    <% if (!listings || listings.length === 0 && (!vehicles || vehicles.length === 0) && (!dhabas || dhabas.length === 0)) { %>
      <div class="no-results">
        <i class="fa fa-search"></i>
        <h4>No results found</h4>
        <p>We couldn't find anything matching "<%= query %>". Try adjusting your search terms or browse our categories:</p>
        <div class="mt-4">
          <a href="/listings" class="btn btn-primary me-3">
            <i class="fa fa-home me-2"></i>Browse Stays
          </a>
          <a href="/vehicles" class="btn btn-success me-3">
            <i class="fa fa-car me-2"></i>Browse Vehicles
          </a>
          <a href="/dhabas" class="btn btn-warning">
            <i class="fa fa-utensils me-2"></i>Browse Dhabas
          </a>
        </div>
      </div>
    <% } %>

  </div>
</div>

<!-- Search Tips -->
<% if (totalResults > 0) { %>
<div class="bg-light py-4">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 text-center">
        <h6>Search Tips</h6>
        <p class="text-muted small mb-0">
          Try searching for location names (Mumbai, Delhi), property types (villa, apartment),
          vehicle types (car, bike), or cuisine types (Punjabi, Italian) for better results.
        </p>
      </div>
    </div>
  </div>
</div>
<% } %>
