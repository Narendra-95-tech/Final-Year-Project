<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#FF385C">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WanderLust">

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="/images/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/icon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/icon-192.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/images/icon-192.png">

  <!-- iOS Splash Screens -->
  <!-- iPhone X, XS, 11 Pro, 12 mini, 13 mini -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
    href="/images/icon-512.png">
  <!-- iPhone XR, 11, 12, 12 Pro, 13, 13 Pro, 14 -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
    href="/images/icon-512.png">
  <!-- iPhone 12 Pro Max, 13 Pro Max, 14 Plus -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"
    href="/images/icon-512.png">
  <!-- iPhone 14 Pro -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)"
    href="/images/icon-512.png">
  <!-- iPhone 14 Pro Max -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)"
    href="/images/icon-512.png">
  <!-- iPad Mini, Air -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"
    href="/images/icon-512.png">
  <!-- iPad Pro 11" -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"
    href="/images/icon-512.png">
  <!-- iPad Pro 12.9" -->
  <link rel="apple-touch-startup-image"
    media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
    href="/images/icon-512.png">

  <link rel="manifest" href="/manifest.json">

  <!-- Socket.IO - Realtime Communication -->
  <script src="/socket.io/socket.io.js"></script>

  <meta name="user-logged-in" content="<%= currUser ? 'true' : 'false' %>">
  <meta name="user-id" content="<%= currUser ? currUser._id : '' %>">
  <meta name="map-token" content="<%= typeof mapToken !== 'undefined' ? mapToken : '' %>">

  <!-- Favicon -->
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/images/wanderlust-logo.svg">
  <link rel="alternate icon" href="/favicon.ico">

  <!-- Safe Page Title -->
  <title>
    <%= typeof pageTitle !=='undefined' ? pageTitle : "WanderLust" %>
  </title>

  <!-- Google Fonts - Poppins with font-display swap for faster rendering -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Performance: DNS Prefetch for external resources -->
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://res.cloudinary.com">
  <link rel="dns-prefetch" href="https://api.mapbox.com">
  <link rel="dns-prefetch" href="https://js.stripe.com">
  <link rel="dns-prefetch" href="https://unpkg.com">

  <!-- Performance: Preconnect to critical origins -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
  <link rel="preconnect" href="https://api.mapbox.com" crossorigin>
  <link rel="preconnect" href="https://js.stripe.com" crossorigin>

  <!-- Bootstrap 5 & Font Awesome - CRITICAL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Mapbox CSS - Required for maps -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.css" rel="stylesheet">

  <!-- AOS (Animate On Scroll) -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Core Application Styles - Load synchronously for proper rendering -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/rating.css">
  <link rel="stylesheet" href="/css/booking.css">
  <link rel="stylesheet" href="/css/vehicles.css">
  <link rel="stylesheet" href="/css/dhabas.css">
  <link rel="stylesheet" href="/css/calendar.css">
  <link rel="stylesheet" href="/css/enhanced-map.css">
  <link rel="stylesheet" href="/css/map-listings-view.css">
  <link rel="stylesheet" href="/css/map-controls.css">
  <link rel="stylesheet" href="/css/mobile-navigation.css">
  <link rel="stylesheet" href="/css/pwa-app-mode.css">

  <!-- Responsive CSS -->
  <link rel="stylesheet" href="/css/mobile-responsive.css">
  <link rel="stylesheet" href="/css/dhabas-responsive.css">
  <link rel="stylesheet" href="/css/listing-details-responsive.css">
  <link rel="stylesheet" href="/css/responsive-forms.css">
  <link rel="stylesheet" href="/css/responsive-user-pages.css">
  <link rel="stylesheet" href="/css/responsive-special-features.css">

  <!-- Non-Critical CSS - Can be deferred -->
  <link rel="stylesheet" href="/css/ai-assistant.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/css/language-selector.css" media="print" onload="this.media='all'">

  <!-- Mapbox JS - Must load before map initialization (loaded at bottom) -->

  <!-- RTL Support -->
  <style>
    /* RTL Layout */
    .rtl {
      direction: rtl;
      text-align: right;
    }

    /* Adjust navbar for RTL */
    .rtl .me-auto {
      margin-right: 0 !important;
      margin-left: auto !important;
    }

    .rtl .ms-2 {
      margin-right: 0.5rem !important;
      margin-left: 0 !important;
    }

    .rtl .me-2 {
      margin-left: 0.5rem !important;
      margin-right: 0 !important;
    }
  </style>

  <style>
    /* Calendar Styles */
    .wanderlust-calendar {
      --primary-color: #FF385C;
      --primary-light: #FF5A5F;
      --text-primary: #222222;
      --text-secondary: #717171;
      --border-color: #EBEBEB;
      --today-bg: #FFF0F0;
      --hover-bg: #F8F8F8;
      --shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
      color: var(--text-primary);
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      position: relative;
      z-index: 1;
    }

    .calendar-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      text-align: center;
      flex-grow: 1;
    }

    .calendar-nav-button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
    }

    .calendar-nav-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: #f8f9fa;
      padding: 10px 0;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: var(--border-color);
      padding: 1px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: white;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      font-size: 0.9rem;
    }

    .calendar-day:hover:not(.empty):not(.disabled) {
      background-color: var(--hover-bg);
      transform: translateY(-2px);
      z-index: 1;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .calendar-day.today {
      background: linear-gradient(135deg, #FF385C, #FF5A5F);
      color: white !important;
      font-weight: 700;
      border-radius: 50%;
      transform: scale(1.15);
      box-shadow: 0 3px 10px rgba(255, 56, 92, 0.3);
      position: relative;
      z-index: 2;
      border: 2px solid white;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 56, 92, 0.4);
      }

      70% {
        box-shadow: 0 0 0 8px rgba(255, 56, 92, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(255, 56, 92, 0);
      }
    }

    .calendar-day.today::after {
      content: 'TODAY';
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      font-weight: 700;
      color: #FF385C;
      background: white;
      padding: 1px 5px;
      border-radius: 10px;
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .calendar-day.selected {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    .calendar-day.disabled {
      color: #ccc;
      background-color: #fafafa;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .calendar-day.empty {
      background-color: transparent;
      cursor: default;
    }

    /* Dark mode support */
    .dark .wanderlust-calendar {
      background: #1f2937;
      color: #f3f4f6;
    }

    .dark .calendar-day {
      background-color: #1f2937;
      color: #f3f4f6;
    }

    .dark .calendar-day.empty {
      background-color: transparent;
    }

    .dark .calendar-day.disabled {
      color: #4b5563;
      background-color: #111827;
    }

    .dark .calendar-weekdays {
      background-color: #111827;
      color: #9ca3af;
    }
  </style>

  <!-- Calendar Component -->
  <script>
    // Define the WanderlustCalendar class in the global scope
    window.WanderlustCalendar = class {
      constructor(containerId, options = {}) {
        this.container = document.getElementById(containerId);
        if (!this.container) {
          console.error(`Calendar container with ID '${containerId}' not found`);
          return;
        }

        this.options = {
          showHeader: true,
          showWeekdays: true,
          showToday: true,
          showClearBtn: false,
          showWeekNumbers: false,
          minDate: null,
          maxDate: null,
          onDateSelect: null,
          onMonthChange: null,
          ...options
        };

        this.currentDate = new Date();
        this.selectedDate = null;

        this.init();
      }

      init() {
        this.render();
        this.bindEvents();
      }

      render() {
        if (!this.container) return;

        const year = this.currentDate.getFullYear();
        const month = this.currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDay = new Date(year, month, 1).getDay();

        // Clear container
        this.container.innerHTML = '';

        // Create calendar container
        const calendarEl = document.createElement('div');
        calendarEl.className = 'wanderlust-calendar';

        // Add header
        if (this.options.showHeader) {
          const headerEl = document.createElement('div');
          headerEl.className = 'calendar-header';

          // Previous month button
          const prevBtn = document.createElement('button');
          prevBtn.className = 'calendar-nav-button prev-month';
          prevBtn.innerHTML = '&lt;';
          prevBtn.addEventListener('click', () => this.previousMonth());

          // Month/year display
          const titleEl = document.createElement('div');
          titleEl.className = 'calendar-title';
          titleEl.textContent = `${this.getMonthName(month)} ${year}`;

          // Next month button
          const nextBtn = document.createElement('button');
          nextBtn.className = 'calendar-nav-button next-month';
          nextBtn.innerHTML = '&gt;';
          nextBtn.addEventListener('click', () => this.nextMonth());

          headerEl.appendChild(prevBtn);
          headerEl.appendChild(titleEl);
          headerEl.appendChild(nextBtn);
          calendarEl.appendChild(headerEl);
        }

        // Add weekdays
        if (this.options.showWeekdays) {
          const weekdaysEl = document.createElement('div');
          weekdaysEl.className = 'calendar-weekdays';

          const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          weekdays.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'weekday';
            dayEl.textContent = day;
            weekdaysEl.appendChild(dayEl);
          });

          calendarEl.appendChild(weekdaysEl);
        }

        // Add days
        const daysEl = document.createElement('div');
        daysEl.className = 'calendar-days';

        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDay; i++) {
          const emptyDay = document.createElement('div');
          emptyDay.className = 'calendar-day empty';
          daysEl.appendChild(emptyDay);
        }

        // Add days of the month
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(year, month, day);
          date.setHours(0, 0, 0, 0); // Normalize time

          const dayEl = document.createElement('div');
          dayEl.className = 'calendar-day';
          dayEl.textContent = day;
          dayEl.dataset.date = date.toISOString().split('T')[0];

          // Highlight today - compare dates without time
          if (date.getDate() === today.getDate() &&
            date.getMonth() === today.getMonth() &&
            date.getFullYear() === today.getFullYear()) {
            dayEl.classList.add('today');
            console.log('Today highlighted:', date);
          }

          // Highlight selected date
          if (this.selectedDate && this.isSameDay(date, this.selectedDate)) {
            dayEl.classList.add('selected');
          }

          // Disable dates outside min/max range
          if ((this.options.minDate && date < this.options.minDate) ||
            (this.options.maxDate && date > this.options.maxDate)) {
            dayEl.classList.add('disabled');
          } else {
            dayEl.addEventListener('click', () => this.selectDate(date));
          }

          daysEl.appendChild(dayEl);
        }

        calendarEl.appendChild(daysEl);
        this.container.appendChild(calendarEl);
      }

      bindEvents() {
        // Event delegation for day clicks
        this.container.addEventListener('click', (e) => {
          const dayEl = e.target.closest('.calendar-day:not(.disabled):not(.empty)');
          if (dayEl && dayEl.dataset.date) {
            const date = new Date(dayEl.dataset.date);
            this.selectDate(date);
          }
        });
      }

      previousMonth() {
        this.currentDate.setMonth(this.currentDate.getMonth() - 1);
        this.render();
        this.triggerMonthChange();
      }

      nextMonth() {
        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
        this.render();
        this.triggerMonthChange();
      }

      selectDate(date) {
        this.selectedDate = date;
        this.render();

        if (typeof this.options.onDateSelect === 'function') {
          this.options.onDateSelect(date);
        }
      }

      triggerMonthChange() {
        if (typeof this.options.onMonthChange === 'function') {
          this.options.onMonthChange(
            this.currentDate.getMonth(),
            this.currentDate.getFullYear()
          );
        }
      }

      isSameDay(date1, date2) {
        return date1.getFullYear() === date2.getFullYear() &&
          date1.getMonth() === date2.getMonth() &&
          date1.getDate() === date2.getDate();
      }

      static getMonthName(monthIndex) {
        const months = [
          'January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December'
        ];
        return months[monthIndex];
      }

      getMonthName(monthIndex) {
        return WanderlustCalendar.getMonthName(monthIndex);
      }
    };

    // Log that the calendar is loaded
    console.log('WanderlustCalendar class loaded');
  </script>


  <!-- Favicon -->
  <link rel="icon" href="/images/wanderlust-logo.svg" type="image/svg+xml">
</head>

<body>
  <!-- Flash Messages (Top) -->
  <%- include("../includes/flash.ejs") %>

    <!-- Navbar -->
    <%- include("../includes/navbar.ejs") %>

      <!-- Mobile Navigation -->
      <%- include("../includes/mobile-nav.ejs") %>

        <!-- Main Content -->
        <main>
          <%- body %>
        </main>

        <!-- Footer -->
        <%- include("../includes/footer.ejs") %>

          <!-- Mapbox GL JS - Load synchronously for map functionality -->
          <script src="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.js"></script>

          <!-- Bootstrap JS Bundle with Popper -->
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

          <!-- AOS (Animate On Scroll) -->
          <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
          <script>
            // Initialize AOS immediately
            if (typeof AOS !== 'undefined') {
              AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true,
                offset: 100
              });
            }
          </script>

          <!-- Socket.io - Defer, not critical for initial render -->
          <script src="/socket.io/socket.io.js" defer></script>
          <script defer>
            // Initialize Socket.io after page load
            document.addEventListener('DOMContentLoaded', function () {
              if (typeof io !== 'undefined') {
                window.socket = io({
                  withCredentials: true,
                  transports: ['websocket', 'polling']
                });

                window.socket.on('connect', () => {
                  console.log('Connected to WanderLust Real-time Services');

                  // Authenticate if user is logged in
                  const userId = document.querySelector('meta[name="user-id"]')?.content;
                  if (userId) {
                    window.socket.emit('authenticate', userId);
                  }
                });
              }
            });
          </script>

          <!-- Custom Scripts - Defer non-critical scripts -->
          <script src="/js/language-manager.js" defer></script>
          <script src="/js/main.js" defer></script>
          <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>
          <script src="/js/script.js" defer></script>
          <script src="/js/booking.js" defer></script>
          <script src="/js/vehicles.js" defer></script>
          <script src="/js/dhabas.js" defer></script>
          <script src="/js/enhanced-map.js" defer></script>
          <script src="/js/map-listings-view.js" defer></script>

          <!-- Performance: Lazy Loading for Images -->
          <script src="/js/lazy-load.js" defer></script>

          <!-- Mobile Navigation -->
          <script src="/js/mobile-navigation.js" defer></script>

          <!-- PWA App Mode -->
          <script src="/js/pwa-app-mode.js" defer></script>

          <!-- PWA Installation Handler -->
          <script src="/js/pwa-install.js" defer></script>

          <!-- Push Notifications -->
          <script src="/js/push-notifications.js" defer></script>

          <!-- Google Maps API (add your API key) -->
          <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places" async
            defer></script>

          <!-- Stripe JS - Async load, only needed on payment pages -->
          <script src="https://js.stripe.com/v3/" async></script>



          <!-- AI Assistant Script -->
          <script src="/js/aiAssistant-fixed.js" defer></script>
          <script>
            // AI Trip Planner Functionality
            document.addEventListener('DOMContentLoaded', () => {
              // AI Trip Planner
              const aiTripPlannerBtn = document.getElementById('aiTripPlannerBtn');
              const aiTripPlannerPanel = document.getElementById('aiTripPlannerPanel');
              const aiTripPlannerClose = document.getElementById('aiTripPlannerClose');
              const aiTripPlanBtn = document.getElementById('aiTripPlanBtn');
              const aiTripQuery = document.getElementById('aiTripQuery');

              // Toggle trip planner panel
              if (aiTripPlannerBtn && aiTripPlannerPanel) {
                aiTripPlannerBtn.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  const isOpening = !aiTripPlannerPanel.classList.contains('visible');

                  // Close any other open panels first
                  document.querySelectorAll('.ai-trip-planner-panel.visible').forEach(panel => {
                    if (panel !== aiTripPlannerPanel) {
                      panel.classList.remove('visible');
                    }
                  });

                  // Toggle current panel
                  aiTripPlannerPanel.classList.toggle('visible', isOpening);

                  // Toggle pulse animation when panel is open
                  if (isOpening) {
                    aiTripPlannerBtn.classList.remove('pulse');
                    // Position the panel above the button
                    const buttonRect = aiTripPlannerBtn.getBoundingClientRect();
                    aiTripPlannerPanel.style.bottom = `${window.innerHeight - buttonRect.top + 20}px`;
                  } else if (Math.random() > 0.7) { // 30% chance to show pulse when closing
                    setTimeout(() => {
                      aiTripPlannerBtn.classList.add('pulse');
                    }, 10000); // Start pulsing after 10 seconds
                  }
                });
              }

              // Add initial pulse animation after page load
              setTimeout(() => {
                if (aiTripPlannerBtn) {
                  aiTripPlannerBtn.classList.add('pulse');
                }
              }, 5000);

              // Close trip planner panel
              if (aiTripPlannerClose) {
                aiTripPlannerClose.addEventListener('click', (e) => {
                  e.preventDefault();
                  aiTripPlannerPanel.classList.remove('visible');
                });
              }

              // Handle trip planning
              if (aiTripPlanBtn && aiTripQuery) {
                const handleTripPlan = () => {
                  const query = aiTripQuery.value.trim();
                  if (query) {
                    // Redirect to the trip planner page with the query
                    window.location.href = `/ai/trip-planner?q=${encodeURIComponent(query)}`;
                  } else {
                    // If no query, just go to the trip planner page
                    window.location.href = '/ai/trip-planner';
                  }
                };

                aiTripPlanBtn.addEventListener('click', handleTripPlan);

                // Also handle Enter key in the input field
                aiTripQuery.addEventListener('keypress', (e) => {
                  if (e.key === 'Enter') {
                    handleTripPlan();
                  }
                });
              }

              // Close panel when clicking outside
              document.addEventListener('click', (e) => {
                if (aiTripPlannerPanel && !aiTripPlannerPanel.contains(e.target) &&
                  aiTripPlannerBtn && !aiTripPlannerBtn.contains(e.target)) {
                  aiTripPlannerPanel.classList.remove('visible');
                }
              });

              // Initialize the AI Assistant when the page loads
              // Check if the AI Assistant is enabled for this page
              const aiAssistantEnabled = !document.body.hasAttribute('data-disable-ai-assistant');

              if (aiAssistantEnabled && window.wanderAI) {
                // Just initialize the assistant but don't auto-open it
                console.log('AI Assistant is ready. Click the assistant button to open it.');
              }
            });
          </script>
          <!-- Premium Confirmation Modal -->
          <div class="modal fade" id="premiumConfirmModal" tabindex="-1" aria-hidden="true" style="z-index: 10001;">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
              <div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">
                <div class="modal-header border-0 pb-0 pt-4 px-4">
                  <div class="bg-danger-subtle rounded-circle d-flex align-items-center justify-content-center mb-3"
                    style="width: 60px; height: 60px; margin: 0 auto; background: rgba(255, 77, 77, 0.1);">
                    <i class="fas fa-exclamation-triangle text-danger fs-3"></i>
                  </div>
                </div>
                <div class="modal-body text-center px-4 pb-4">
                  <h4 class="fw-bold mb-2" id="confirmTitle">Confirm Action</h4>
                  <p class="text-muted mb-4" id="confirmMessage">Are you sure you want to proceed?</p>
                  <div class="d-grid gap-2">
                    <button type="button" class="btn btn-danger py-3 fw-bold rounded-pill shadow-sm"
                      id="confirmBtnPrimary"
                      style="background: linear-gradient(135deg, #FF4D4D 0%, #FF2626 100%); border: none;">Yes,
                      Delete</button>
                    <button type="button" class="btn btn-light py-3 fw-bold rounded-pill"
                      data-bs-dismiss="modal">Cancel</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <script>
            // Global Premium Confirmation Function
            window.wanderConfirm = function (title, message, confirmText = 'Yes, Proceed') {
              return new Promise((resolve) => {
                const modalEl = document.getElementById('premiumConfirmModal');
                const modal = new bootstrap.Modal(modalEl);

                document.getElementById('confirmTitle').innerText = title;
                document.getElementById('confirmMessage').innerText = message;
                const primaryBtn = document.getElementById('confirmBtnPrimary');
                primaryBtn.innerText = confirmText;

                // Reset event listener
                const newPrimaryBtn = primaryBtn.cloneNode(true);
                primaryBtn.parentNode.replaceChild(newPrimaryBtn, primaryBtn);

                newPrimaryBtn.addEventListener('click', () => {
                  modal.hide();
                  resolve(true);
                });

                modalEl.addEventListener('hidden.bs.modal', function handler() {
                  resolve(false);
                  modalEl.removeEventListener('hidden.bs.modal', handler);
                }, { once: true });

                modal.show();
              });
            };
          </script>
</body>

</html>