<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Search Location Demo</title>
    
    <!-- Mapbox CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/map-search.css">
    <link rel="stylesheet" href="/css/enhanced-map.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        .demo-header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .demo-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 700;
        }
        
        .demo-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .demo-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        
        .search-panel {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #e1e5e9;
        }
        
        .map-panel {
            position: relative;
            background: #ffffff;
        }
        
        #map {
            width: 100%;
            height: 600px;
        }
        
        .selected-location {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e1e5e9;
            display: none;
        }
        
        .selected-location.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        .selected-location h4 {
            margin: 0 0 10px 0;
            color: #2d3436;
            font-size: 16px;
            font-weight: 600;
        }
        
        .selected-location p {
            margin: 0;
            color: #868e96;
            font-size: 14px;
        }
        
        .selected-location .coords {
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #ff6b6b;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .demo-content {
                grid-template-columns: 1fr;
            }
            
            .search-panel {
                border-right: none;
                border-bottom: 1px solid #e1e5e9;
                padding: 30px 20px;
            }
            
            .map-panel {
                min-height: 400px;
            }
            
            #map {
                height: 400px;
            }
            
            .demo-header {
                padding: 20px;
            }
            
            .demo-header h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üó∫Ô∏è Map Search Location</h1>
            <p>Search for locations or select from popular destinations</p>
        </div>
        
        <div class="demo-content">
            <div class="search-panel">
                <div id="map-search"></div>
                
                <div id="selected-location" class="selected-location">
                    <h4>üìç Selected Location</h4>
                    <p id="location-name"></p>
                    <div class="coords" id="location-coords"></div>
                </div>
            </div>
            
            <div class="map-panel">
                <div id="map"></div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script src="/js/map-search.js"></script>
    
    <script>
        // Initialize Mapbox
        mapboxgl.accessToken = 'pk.eyJ1IjoibmFyZW5kcmEtYmh1dGUiLCJhIjoiY21rNW92NW9pMG5yNDNkcXNjcW5wcm1qNSJ9.SqaVT3eDGXJKZAiiUMF2Xw';
        
        let map;
        let currentMarker;
        
        function initializeMap() {
            map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [72.8777, 19.0760], // Mumbai
                zoom: 10
            });
            
            // Add navigation controls
            map.addControl(new mapboxgl.NavigationControl());
            
            // Add geolocate control
            map.addControl(new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true
            }));
        }
        
        function initializeSearch() {
            const mapSearch = new MapSearchLocation('map-search', {
                placeholder: 'Search location...',
                popularLocations: [
                    { name: 'Mumbai Airport', icon: '‚úàÔ∏è', coords: [72.8679, 19.0896] },
                    { name: 'Pune Railway Station', icon: 'üöÇ', coords: [73.8567, 18.5294] },
                    { name: 'Lonavala', icon: 'üèîÔ∏è', coords: [73.4084, 18.7546] },
                    { name: 'Mahabaleshwar', icon: 'üå≤', coords: [73.6588, 17.9249] },
                    { name: 'Shirdi', icon: 'üôè', coords: [74.4797, 19.7680] },
                    { name: 'Gateway of India', icon: 'üèõÔ∏è', coords: [72.8347, 18.9220] },
                    { name: 'Marine Drive', icon: 'üåä', coords: [72.8209, 18.9440] },
                    { name: 'Khandala', icon: '‚õ∞Ô∏è', coords: [73.3270, 18.7516] }
                ],
                onLocationSelect: (location) => {
                    handleLocationSelect(location);
                },
                onSearch: async (query) => {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            });
            
            return mapSearch;
        }
        
        function handleLocationSelect(location) {
            // Update selected location display
            const selectedLocationDiv = document.getElementById('selected-location');
            const locationName = document.getElementById('location-name');
            const locationCoords = document.getElementById('location-coords');
            
            locationName.textContent = location.name;
            locationCoords.textContent = `Coordinates: [${location.coords[0]}, ${location.coords[1]}]`;
            selectedLocationDiv.classList.add('show');
            
            // Update map
            if (map) {
                // Remove existing marker
                if (currentMarker) {
                    currentMarker.remove();
                }
                
                // Add new marker
                currentMarker = new mapboxgl.Marker({
                    color: '#ff6b6b'
                })
                .setLngLat(location.coords)
                .addTo(map);
                
                // Fly to location
                map.flyTo({
                    center: location.coords,
                    zoom: 12,
                    speed: 2,
                    curve: 1.42,
                    easing: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t
                });
                
                // Add popup
                const popup = new mapboxgl.Popup({
                    offset: 25,
                    closeButton: false,
                    className: 'location-popup'
                })
                .setHTML(`
                    <div style="padding: 10px; text-align: center;">
                        <strong style="color: #2d3436; font-size: 14px;">${location.name}</strong>
                        <div style="margin-top: 4px; color: #868e96; font-size: 12px;">
                            üìç ${location.coords[1].toFixed(4)}, ${location.coords[0].toFixed(4)}
                        </div>
                    </div>
                `);
                
                currentMarker.setPopup(popup);
                popup.addTo(map);
                
                // Open popup briefly
                setTimeout(() => {
                    popup.remove();
                }, 3000);
            }
            
            console.log('Location selected:', location);
        }
        
        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            try {
                initializeMap();
                initializeSearch();
                console.log('‚úÖ Map Search Demo initialized successfully!');
            } catch (error) {
                console.error('‚ùå Error initializing demo:', error);
            }
        });
    </script>
</body>
</html>
