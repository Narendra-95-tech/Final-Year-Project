<% layout("/layouts/boilerplate") -%>

<style>
  .form-container {
    max-width: 900px;
    margin: 2rem auto;
    background: var(--white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: 2.5rem;
    border: 1px solid var(--gray-200);
  }

  .form-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid var(--gray-200);
  }

  .form-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.5rem;
  }

  .form-subtitle {
    color: var(--gray-600);
    font-size: 1rem;
  }

  .form-section {
    margin-bottom: 2rem;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .section-icon {
    color: var(--primary-orange);
    font-size: 1.5rem;
  }

  .form-label {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
    display: block;
  }

  .form-control, .form-select {
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 0.75rem 1rem;
    transition: all var(--transition-fast);
    font-size: 0.95rem;
  }

  .form-control:focus, .form-select:focus {
    border-color: var(--primary-orange);
    box-shadow: 0 0 0 3px rgba(253, 126, 20, 0.1);
    outline: none;
  }

  .image-upload-area {
    border: 2px dashed var(--gray-300);
    border-radius: var(--radius-lg);
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    background: var(--gray-50);
  }

  .image-upload-area:hover {
    border-color: var(--primary-orange);
    background: var(--primary-orange-light);
  }

  .image-upload-icon {
    font-size: 3rem;
    color: var(--gray-400);
    margin-bottom: 1rem;
  }

  .image-preview {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius-lg);
    margin-top: 1rem;
    display: none;
  }

  .btn-submit {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, var(--primary-orange), var(--primary-orange-hover));
    color: var(--white);
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    margin-top: 1.5rem;
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .required-indicator {
    color: var(--secondary-red);
    margin-left: 0.25rem;
  }

  .help-text {
    font-size: 0.85rem;
    color: var(--gray-600);
    margin-top: 0.25rem;
  }

  [data-theme="dark"] .form-container {
    background: var(--gray-100);
    border-color: var(--gray-200);
  }

  [data-theme="dark"] .image-upload-area {
    background: var(--gray-200);
    border-color: var(--gray-300);
  }
</style>

<div class="container">
  <div class="form-container animate-fade-in">
    <div class="form-header">
      <h1 class="form-title">
        <i class="fas fa-home me-2"></i>
        Add New Listing
      </h1>
      <p class="form-subtitle">Share your property with travelers around the world</p>
    </div>

    <form method="POST" action="/listings" enctype="multipart/form-data" novalidate class="needs-validation">
      
      <!-- Basic Information -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-info-circle section-icon"></i>
          Basic Information
        </h3>

        <div class="mb-3">
          <label for="title" class="form-label">
            Property Title<span class="required-indicator">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="title" 
            name="listing[title]" 
            placeholder="e.g., Cozy Beachfront Villa with Ocean View"
            required
          >
          <div class="help-text">Make it catchy and descriptive</div>
          <div class="invalid-feedback">Please provide a title</div>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">
            Description<span class="required-indicator">*</span>
          </label>
          <textarea 
            class="form-control" 
            id="description" 
            name="listing[description]" 
            rows="5"
            placeholder="Describe your property, amenities, nearby attractions..."
            required
          ></textarea>
          <div class="help-text">Minimum 50 characters recommended</div>
          <div class="invalid-feedback">Please provide a description</div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="category" class="form-label">
              Category<span class="required-indicator">*</span>
            </label>
            <select class="form-select" id="category" name="listing[category]" required>
              <option value="">Select category...</option>
              <option value="trending">Trending</option>
              <option value="rooms">Rooms</option>
              <option value="iconic cities">Iconic Cities</option>
              <option value="mountains">Mountains</option>
              <option value="castles">Castles</option>
              <option value="pools">Amazing Pools</option>
              <option value="camping">Camping</option>
              <option value="farms">Farms</option>
              <option value="arctic">Arctic</option>
              <option value="domes">Domes</option>
              <option value="boats">Boats</option>
            </select>
            <div class="invalid-feedback">Please select a category</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="price" class="form-label">
              Price per Night (â‚¹)<span class="required-indicator">*</span>
            </label>
            <input 
              type="number" 
              class="form-control" 
              id="price" 
              name="listing[price]" 
              placeholder="2500"
              min="0"
              required
            >
            <div class="invalid-feedback">Please provide a valid price</div>
          </div>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-map-marker-alt section-icon"></i>
          Location
        </h3>

        <div class="row">
          <div class="col-md-8 mb-3">
            <label for="location" class="form-label">
              Address/Location<span class="required-indicator">*</span>
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="location" 
              name="listing[location]" 
              placeholder="e.g., Goa, Baga Beach"
              required
            >
            <div class="invalid-feedback">Please provide a location</div>
          </div>

          <div class="col-md-4 mb-3">
            <label for="country" class="form-label">
              Country<span class="required-indicator">*</span>
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="country" 
              name="listing[country]" 
              placeholder="India"
              required
            >
            <div class="invalid-feedback">Please provide a country</div>
          </div>
        </div>
      </div>

      <!-- Image Upload -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-image section-icon"></i>
          Property Image
        </h3>

        <div class="image-upload-area" onclick="document.getElementById('image-input').click()">
          <i class="fas fa-cloud-upload-alt image-upload-icon"></i>
          <p class="mb-0"><strong>Click to upload</strong> or drag and drop</p>
          <p class="help-text">PNG, JPG, JPEG (Max 5MB)</p>
          <input 
            type="file" 
            id="image-input" 
            name="listing[image]" 
            accept="image/*"
            style="display: none;"
            onchange="previewImage(event)"
            required
          >
          <img id="image-preview" class="image-preview" alt="Preview">
        </div>
        <div class="invalid-feedback">Please upload an image</div>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="btn-submit">
        <i class="fas fa-plus-circle me-2"></i>
        Create Listing
      </button>
    </form>
  </div>
</div>

<script>
  // Form validation
  (function() {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();

  // Image preview
  function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById('image-preview');
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
  }

  // Drag and drop
  const uploadArea = document.querySelector('.image-upload-area');
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ['dragenter', 'dragover'].forEach(eventName => {
    uploadArea.addEventListener(eventName, () => {
      uploadArea.style.borderColor = 'var(--primary-orange)';
      uploadArea.style.background = 'var(--primary-orange-light)';
    });
  });

  ['dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, () => {
      uploadArea.style.borderColor = 'var(--gray-300)';
      uploadArea.style.background = 'var(--gray-50)';
    });
  });

  uploadArea.addEventListener('drop', (e) => {
    const dt = e.dataTransfer;
    const files = dt.files;
    document.getElementById('image-input').files = files;
    previewImage({ target: { files: files } });
  });
</script>
