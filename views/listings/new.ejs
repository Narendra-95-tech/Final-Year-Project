<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Listing - WanderLust</title>
    <link rel="stylesheet" href="/css/create-listing.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <% layout("layouts/boilerplate") %>

        <div class="create-listing-container">

            <div class="form-header">
                <h1>Welcome to hosting</h1>
                <p>List your place on WanderLust and start earning.</p>
            </div>

            <form method="POST" action="/listings" novalidate class="needs-validation" enctype="multipart/form-data">

                <!-- SECTION 1: BASIC INFO -->
                <div class="form-section">
                    <h2 class="section-title">The Basics</h2>

                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input name="listing[title]" placeholder="e.g. Cozy Cottage in the Hills" type="text"
                            class="form-control" required />
                        <div class="input-hint">Catchy titles attract more guests.</div>
                        <div class="valid-feedback">Looks great!</div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea name="listing[description]" rows="4" class="form-control"
                            placeholder="Describe your place..." required></textarea>
                        <div class="invalid-feedback">Please enter a description</div>
                    </div>

                    <div class="mb-3">
                        <label for="price" class="form-label">Price per night (â‚¹)</label>
                        <input name="listing[price]" type="number" placeholder="1200" class="form-control" required />
                        <div class="invalid-feedback">Please enter a valid price</div>
                    </div>
                </div>

                <!-- SECTION 2: PHOTOS -->
                <div class="form-section">
                    <h2 class="section-title">Property Photos</h2>
                    <p class="mb-3 text-secondary" style="font-size: 14px;">Upload at least 5 photos for the best
                        results. You can select multiple.</p>

                    <div class="upload-zone" id="upload-zone">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <div class="upload-text">Drag your photos here</div>
                        <div class="upload-subtext">or click to browse</div>
                        <input name="listing[image]" id="image-input" type="file" multiple required accept="image/*" />
                    </div>

                    <div class="image-preview-grid" id="preview-grid">
                        <!-- Previews will appear here -->
                    </div>
                </div>

                <!-- SECTION 3: LOCATION -->
                <div class="form-section">
                    <h2 class="section-title">Location</h2>

                    <div class="mb-3">
                        <label for="location" class="form-label">Location / City</label>
                        <input name="listing[location]" placeholder="e.g. Jaipur, Rajasthan" type="text"
                            class="form-control" required />
                        <div class="invalid-feedback">Location is required</div>
                    </div>

                    <div class="mb-3">
                        <label for="country" class="form-label">Country</label>
                        <input name="listing[country]" placeholder="e.g. India" type="text" class="form-control"
                            required />
                        <div class="invalid-feedback">Country is required</div>
                    </div>
                </div>

                <!-- SECTION 4: PROPERTY DETAILS -->
                <div class="form-section">
                    <h2 class="section-title">Property Details</h2>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Property Type</label>
                            <select name="listing[propertyType]" class="form-control form-select">
                                <option value="Apartment">Apartment</option>
                                <option value="House">House</option>
                                <option value="Villa">Villa</option>
                                <option value="Hotel">Hotel</option>
                                <option value="Resort">Resort</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Guest Capacity</label>
                            <input name="listing[guests]" type="number" value="2" min="1" class="form-control" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Bedrooms</label>
                            <input name="listing[bedrooms]" type="number" value="1" min="0" class="form-control" />
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Beds</label>
                            <input name="listing[beds]" type="number" value="1" min="1" class="form-control" />
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Bathrooms</label>
                            <input name="listing[bathrooms]" type="number" value="1" min="0.5" step="0.5"
                                class="form-control" />
                        </div>
                    </div>
                </div>

                <button class="create-btn mt-2">Create Listing</button>
                <br><br>

            </form>
        </div>

        <!-- Client-side Preview Script -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const input = document.getElementById('image-input');
                const previewGrid = document.getElementById('preview-grid');
                const uploadZone = document.getElementById('upload-zone');

                input.addEventListener('change', function (e) {
                    const files = Array.from(e.target.files);

                    // Clear existing previews
                    previewGrid.innerHTML = '';

                    files.forEach((file, index) => {
                        if (!file.type.startsWith('image/')) return;

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const div = document.createElement('div');
                            div.className = 'preview-item';
                            div.innerHTML = `<img src="${e.target.result}" class="preview-img">`;
                            previewGrid.appendChild(div);
                        }
                        reader.readAsDataURL(file);
                    });

                    if (files.length > 0) {
                        uploadZone.style.borderColor = '#222';
                        uploadZone.querySelector('.upload-text').textContent = `${files.length} photos selected`;
                    }
                });

                // Drag and drop effects
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.style.backgroundColor = '#f0f0f0';
                    uploadZone.style.borderColor = '#222';
                });

                uploadZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadZone.style.backgroundColor = '#fafafa';
                    uploadZone.style.borderColor = '#b0b0b0';
                });
            });
        </script>
</body>

</html>